<div class="product-details-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Chargement du produit...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <h2>Produit non trouvé</h2>
    <p>Le produit que vous recherchez n'existe pas ou n'est plus disponible.</p>
    <button class="btn btn-primary" (click)="goBack()">Retour au catalogue</button>
  </div>

  <!-- Product Details -->
  <div *ngIf="!loading && !error && product" class="product-details">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
      <a (click)="goBack()">Catalogue</a>
      <span class="separator">></span>
      <span class="current">{{ product.name }}</span>
    </nav>

    <div class="product-content">
      <!-- Product Image Section -->
      <div class="product-image-section">
        <div class="product-image">
          <img 
            [src]="product.imageUrl" 
            [alt]="product.name"
            (error)="onImageError($event)"
          />
          <div *ngIf="product.origin" class="product-origin-badge">
            {{ product.origin }}
          </div>
        </div>
      </div>

      <!-- Product Info Section -->
      <div class="product-info-section">
        <h1 class="product-title">{{ product.name }}</h1>
        
        <p class="product-description">{{ product.description }}</p>

        <!-- Preparation Info -->
        <div *ngIf="product.preparation" class="preparation-info">
          <h3>Informations de préparation</h3>
          <p>{{ product.preparation }}</p>
        </div>

        <!-- Price Display -->
        <div class="price-display-section">
          <div class="base-price-info">
            <span class="price-label">Prix de base :</span>
            <span class="base-price">{{ product.pricePerBaseUnit | currency:'EUR':'symbol':'1.2-2' }} / {{ getUnitLabel(product.baseUnit) }}</span>
          </div>
          
          <!-- Prix calculé en temps réel -->
          <div class="calculated-price" *ngIf="selectedQuantity.value > 0">
            <div class="unit-price">
              <span class="price-label">Prix unitaire :</span>
              <span class="price-value">{{ priceCalculation.unitPrice | currency:'EUR':'symbol':'1.2-2' }} / {{ getUnitLabel(selectedQuantity.unit) }}</span>
            </div>
            <div class="total-price">
              <span class="price-label">Prix total :</span>
              <span class="price-value total">{{ priceCalculation.totalPrice | currency:'EUR':'symbol':'1.2-2' }}</span>
            </div>
          </div>
        </div>

        <!-- Discount Offer (si applicable) -->
        <div *ngIf="discountPercentage > 0" class="discount-offer">
          <div class="discount-badge">
            <span class="discount-text">-{{ discountPercentage }}% de réduction !</span>
          </div>
          <div class="price-section">
            <span class="original-price">{{ priceCalculation.originalPrice | currency:'EUR':'symbol':'1.2-2' }}</span>
            <span class="discounted-price">{{ priceCalculation.discountedPrice | currency:'EUR':'symbol':'1.2-2' }}</span>
          </div>
          <p class="discount-description">
            Économisez {{ priceCalculation.discount | currency:'EUR':'symbol':'1.2-2' }} sur votre commande !
          </p>
        </div>

        <!-- Quantity and Unit Selection -->
        <div class="quantity-unit-section">
          <!-- Unit Selection -->
          <div class="unit-selection" *ngIf="product.allowedUnits && product.allowedUnits.length > 1">
            <label for="unit-select">Unité :</label>
            <select 
              id="unit-select"
              class="unit-select"
              [(ngModel)]="selectedQuantity.unit"
              (ngModelChange)="onUnitChange()">
              <option *ngFor="let unit of product.allowedUnits" [value]="unit">
                {{ getUnitLabel(unit) }}
              </option>
            </select>
          </div>

          <!-- Quantity Input -->
          <div class="quantity-section">
            <label for="quantity-input">Quantité :</label>
            <div class="quantity-controls">
              <button 
                class="quantity-btn"
                (click)="decreaseQuantity()"
                [disabled]="selectedQuantity.value <= getMinQuantity()">
                -
              </button>
              
              <input 
                id="quantity-input"
                type="number"
                class="quantity-input"
                [(ngModel)]="selectedQuantity.value"
                (ngModelChange)="onQuantityChange()"
                [step]="getQuantityStep()"
                [min]="getMinQuantity()"
                [max]="getMaxQuantity()"
                [placeholder]="getQuantityPlaceholder()"
              />
              
              <button 
                class="quantity-btn"
                (click)="increaseQuantity()"
                [disabled]="selectedQuantity.value >= getMaxQuantity()">
                +
              </button>
            </div>
            
            <div class="quantity-info">
              <small class="quantity-hint">
                {{ getQuantityHint() }}
              </small>
            </div>
          </div>

          <!-- Stock Information -->
          <div class="stock-info">
            <span class="stock-label">Stock disponible :</span>
            <span class="stock-value" [class.low-stock]="isLowStock()">
              {{ product.stockQuantity }} {{ getUnitLabel(product.baseUnit) }}
            </span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button 
            class="btn btn-primary add-to-cart-btn"
            (click)="addToCart()"
            [disabled]="!canAddToCart()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
            </svg>
            Ajouter au panier
            <span class="cart-quantity" *ngIf="selectedQuantity.value > 0">
              ({{ selectedQuantity.value }} {{ getUnitLabel(selectedQuantity.unit) }})
            </span>
          </button>
          
          <button class="btn btn-outline" (click)="goBack()">
            Retour au catalogue
          </button>
        </div>

        <!-- Shipping Info -->
        <div class="shipping-info">
          <div class="shipping-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M20,8H17V4H3C1.89,4 1,4.89 1,6V18A2,2 0 0,0 3,20H4A3,3 0 0,0 7,23A3,3 0 0,0 10,20H14A3,3 0 0,0 17,23A3,3 0 0,0 20,20H21A2,2 0 0,0 23,18V12L20,8M19,9.5L21.5,12H17V9.5H19M7,21A1,1 0 0,1 6,20A1,1 0 0,1 7,19A1,1 0 0,1 8,20A1,1 0 0,1 7,21M17,21A1,1 0 0,1 16,20A1,1 0 0,1 17,19A1,1 0 0,1 18,20A1,1 0 0,1 17,21Z"/>
            </svg>
          </div>
          <div class="shipping-text">
            <h4>Livraison gratuite</h4>
            <p>
              Livraison <strong>gratuite</strong> pour toute commande supérieure à 
              <strong>50€</strong>. Livraison sous 24-48h.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

